(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{110:function(e,n,t){e.exports=t.p+"static/media/challengeApp.e0e8a1ad.png"},119:function(e,n,t){e.exports=t(146)},146:function(e,n,t){"use strict";t.r(n);var a=t(103),r=t(0),l=t.n(r),c=t(15),o=t.n(c),i=t(33),u=t(113),s=t(20),m=t(171),g=t(173),d=t(175),h=t(176),E=t(189),f=t(190),p=t(177),b=t(108),v=t.n(b),D=t(18),O=t(10),j=Object(m.a)((function(e){return{root:{flexGrow:1,marginBottom:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}})),w=function(e){var n=e.user,t=j(),a=Object(D.f)(),c=Object(r.useState)(null),o=Object(s.a)(c,2),u=o[0],m=o[1],b=function(){m(null)},w=Object(O.useApolloClient)();return l.a.createElement("div",null,l.a.createElement(g.a,{position:"static"},l.a.createElement(d.a,null,l.a.createElement(h.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",onClick:function(e){m(e.currentTarget)},"aria-controls":"simple-menu","aria-haspopup":"true"},l.a.createElement(v.a,null)),l.a.createElement(E.a,{id:"simple-menu",anchorEl:u,keepMounted:!0,open:Boolean(u),onClose:b},l.a.createElement(f.a,{onClick:b},l.a.createElement(i.b,{to:"/"},"About")),n&&l.a.createElement(f.a,{onClick:b},l.a.createElement(i.b,{to:"/challenges"},"Challenges")),l.a.createElement(f.a,{onClick:b},n?l.a.createElement(i.b,{onClick:function(){a.push("/"),localStorage.clear(),w.resetStore()}},"Logout"):l.a.createElement(i.b,{to:"/login"},"Login"))),l.a.createElement(p.a,{variant:"h6",className:t.title},"Your Challenge App"))))},Y=t(80),C=t.n(Y),y=t(109),k=t(38);function S(){var e=Object(k.a)(["\n  mutation createOwnChallenge($challengeID: String!,\n   $userID: String!, $description: String, $startDate: String, $endDate: String) {\n    createOwnChallenge(challengeID: $challengeID, userID: $userID, description: $description, startDate: $startDate, endDate: $endDate) {\n      challenge {\n      id \n      name\n      }\n      user {\n      id\n      username\n      }\n      description\n      startDate\n      endDate\n    }\n  }\n"]);return S=function(){return e},e}function M(){var e=Object(k.a)(["\n  mutation createUser($username: String!,\n   $password: String!) {\n    createUser(username: $username, password: $password) {\n      id\n      username\n      password\n    }\n  }\n"]);return M=function(){return e},e}function $(){var e=Object(k.a)(["\n  mutation editOwnChallenge($challengeID: String!, $abortDate: String) {\n    editOwnChallenge(id: $challengeID, stop: true, abortDate: $abortDate) {\n      id\n      entries\n      active\n      abortDate\n    }\n  }\n"]);return $=function(){return e},e}function I(){var e=Object(k.a)(["\n  mutation editOwnChallenge($challengeID: String!, $entry: String!) {\n    editOwnChallenge(id: $challengeID, entry: $entry) {\n      id\n      entries\n    }\n  }\n"]);return I=function(){return e},e}function q(){var e=Object(k.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      value\n    }\n  }\n"]);return q=function(){return e},e}var x=Object(O.gql)(q()),B=Object(O.gql)(I()),N=Object(O.gql)($()),A=(Object(O.gql)(M()),Object(O.gql)(S())),L=function(e){var n=e.setError,t=Object(r.useState)(""),a=Object(s.a)(t,2),c=a[0],o=a[1],i=Object(r.useState)(""),u=Object(s.a)(i,2),m=u[0],g=u[1],d=Object(D.f)(),h=Object(O.useMutation)(x,{onError:function(e){n(e.graphQLErrors[0].message),setTimeout((function(){n(null)}),3e3)}}),E=Object(s.a)(h,2),f=E[0],p=E[1],b=Object(O.useApolloClient)();Object(r.useEffect)((function(){if(p.data){var e=p.data.login.value;localStorage.setItem("user-token",e),d.push("/challenges"),b.resetStore()}}),[p.data]);var v=function(){var e=Object(y.a)(C.a.mark((function e(n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,f({variables:{username:c,password:m}});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return l.a.createElement("div",null,l.a.createElement("h2",null,"Login"),l.a.createElement("form",{onSubmit:v},l.a.createElement("div",null,"username"," ",l.a.createElement("input",{value:c,onChange:function(e){var n=e.target;return o(n.value)},id:"username"})),l.a.createElement("div",null,"password"," ",l.a.createElement("input",{type:"password",value:m,onChange:function(e){var n=e.target;return g(n.value)},id:"password"})),l.a.createElement("button",{type:"submit",id:"login-button"},"login")))},Q=function(e){var n=e.setError;return l.a.createElement("div",null,l.a.createElement(L,{setError:n}))},G=t(178),R=t(110),P=t.n(R),z=function(){return l.a.createElement("div",null,l.a.createElement(G.a,{container:!0,justify:"center",alignItems:"center"},l.a.createElement(G.a,{item:!0,xs:12},l.a.createElement("br",null),l.a.createElement(p.a,{variant:"subtitle2",gutterBottom:!0,align:"center"},"This app is for keeping score of your monthly sport challenges and sharing your accomplishments with your friends.")),l.a.createElement("img",{src:P.a,height:"200",alt:"Challenge app"})))};function T(){var e=Object(k.a)(["\n  query {\n    activeOwnChallenges {\n      id\n      challenge {\n        id\n        name\n      }\n      user {\n        username\n      }\n      description\n      startDate\n      endDate\n      active\n      entries\n      abortDate\n    }\n  }\n"]);return T=function(){return e},e}function J(){var e=Object(k.a)(["\n  query {\n    allChallenges {\n      id\n      name\n      description\n      link\n      duration\n      ownChallenges {\n        id\n        description\n        startDate\n        endDate\n        active\n        entries\n        abortDate\n      }\n    }\n  }\n"]);return J=function(){return e},e}function U(){var e=Object(k.a)(["\n  query {\n    me {\n      id\n      username\n    }\n  }\n"]);return U=function(){return e},e}var H=Object(O.gql)(U()),W=Object(O.gql)(J()),_=Object(O.gql)(T()),F=function(){var e=Object(O.useQuery)(H).data;return console.log("data meeee: ",e),e?e.me:null},K=t(179),V=t(148),X=t(180),Z=t(181),ee=t(182),ne=t(183),te=t(184),ae=function(){var e=Object(O.useQuery)(W,{fetchPolicy:"cache-and-network"}).data;return e?e.allChallenges:void 0},re=function(){var e=Object(O.useQuery)(_,{fetchPolicy:"cache-and-network"}).data;return e?e.activeOwnChallenges:void 0},le=Object(m.a)({table:{minWidth:650}}),ce=function(e){var n=e.username,t=le(),a=ae(),r=re();return l.a.createElement("div",null,l.a.createElement("p",null,"Logged in as ",l.a.createElement("b",null,n)),r&&r.length>0&&l.a.createElement("div",null,l.a.createElement("h2",null,"Ongoing Challenges"),l.a.createElement(K.a,{component:V.a},l.a.createElement(X.a,{className:t.table,"aria-label":"own challenges table"},l.a.createElement(Z.a,null,l.a.createElement(ee.a,null,l.a.createElement(ne.a,null,l.a.createElement("b",null,"Name")))),l.a.createElement(te.a,null,r.map((function(e){return l.a.createElement(ee.a,{key:e.id},l.a.createElement(ne.a,{component:"th",scope:"row"},l.a.createElement(i.b,{to:"challenges/".concat(e.challenge.id)},e.challenge.name)))})))))),l.a.createElement("h2",null,"All Challenges"),l.a.createElement("div",null,l.a.createElement(K.a,{component:V.a},l.a.createElement(X.a,{className:t.table,"aria-label":"all challenges table"},l.a.createElement(Z.a,null,l.a.createElement(ee.a,null,l.a.createElement(ne.a,null,l.a.createElement("b",null,"Name")))),l.a.createElement(te.a,null,a&&a.map((function(e){return l.a.createElement(ee.a,{key:e.id},l.a.createElement(ne.a,{component:"th",scope:"row"},l.a.createElement(i.b,{to:"challenges/".concat(e.id)},e.name)))})))))))},oe=t(187),ie=t(188),ue=t(185),se=t(186),me=(t(136),t(28)),ge=t.n(me),de=Object(m.a)((function(e){return{root:{marginLeft:e.spacing(2),flexGrow:1,marginBottom:1},checkedIcon:{fill:"green",fontSize:"1rem"},uncheckedIcon:{fill:"red",fontSize:"1rem"}}})),he=function(e){var n=e.challenge,t=de(),a=Object(r.useState)(null),c=Object(s.a)(a,2),o=c[0],i=c[1],u=n.entries,m=Object(O.useMutation)(B,{refetchQueries:[{query:_}],onError:function(e){console.log("error: ",e)}}),g=Object(s.a)(m,1)[0];return l.a.createElement("div",null,l.a.createElement("p",null,"Started: ",ge()(n.startDate).format("DD.MM.YYYY")),l.a.createElement("p",null,"Ending: ",ge()(n.endDate).format("DD.MM.YYYY")),l.a.createElement("p",null,"Click a day on calendar to mark as done. ",l.a.createElement("br",null),"You can edit past challenge days but you cannot alter future days in advance."),l.a.createElement(ie.a,{onChange:function(e){return i(e),g({variables:{challengeID:n.id,entry:ge()(e).format("YYYY-MM-DD")}})},value:o,minDate:new Date(n.startDate),maxDate:new Date,allowPartialRange:!0,tileContent:function(e){var a=e.date;return a<ge()(n.startDate)||a>ge()(n.endDate)?null:u.includes(ge()(a).format("YYYY-MM-DD"))?l.a.createElement(ue.a,{className:t.checkedIcon}):l.a.createElement(se.a,{className:t.uncheckedIcon})}}))},Ee=function(e){var n=e.challenge,t=e.duration;return l.a.createElement("div",null,l.a.createElement("p",null,"Challenge time: ".concat(ge()(n.startDate).format("DD.MM.YYYY")," - ").concat(ge()(n.endDate).format("DD.MM.YYYY"))),n.abortDate?l.a.createElement("p",null,"Challenge was aborted ".concat(ge()(n.abortDate).format("DD.MM.YYYY"),".")):l.a.createElement("p",null,"You finished the challenge!"),l.a.createElement("p",null,"Results: ".concat(n.entries.length,"/").concat(t," days done")))},fe=Object(m.a)((function(e){return{root:{marginLeft:e.spacing(2),flexGrow:1,marginBottom:1}}})),pe=function(e){var n=e.challenge,t=e.user,a=ge()(),c=ge()().add(n.duration,"day"),o=fe(),i=Object(O.useMutation)(N,{refetchQueries:[{query:_}],onError:function(e){console.log("error: ",e)}}),u=Object(s.a)(i,1)[0],m=n.ownChallenges.find((function(e){return e.active}));m&&a>c&&u({variables:{challengeID:m.id}});var g=n.ownChallenges.length>0&&!m&&n.ownChallenges[n.ownChallenges.length-1],d=Object(r.useState)("testing... "),h=Object(s.a)(d,2),E=h[0],f=(h[1],Object(O.useMutation)(A,{refetchQueries:[{query:W}],onError:function(e){console.log("error: ",e)}})),p=Object(s.a)(f,1)[0];return l.a.createElement("div",{className:o.root},l.a.createElement("h1",null,n.name),l.a.createElement("p",null,n.description),l.a.createElement("p",null,l.a.createElement("a",{href:n.link,target:"_blank"},n.link)),l.a.createElement("p",null,"Challenge duration: ",n.duration," days"),m?l.a.createElement("div",null,l.a.createElement(he,{challenge:m}),l.a.createElement("br",null),l.a.createElement(oe.a,{variant:"outlined",color:"red",onClick:function(){return u({variables:{challengeID:m.id,abortDate:a.format("YYYY-MM-DD")}})}},"Abort challenge")):l.a.createElement("div",null,g&&l.a.createElement(Ee,{challenge:g,duration:n.duration}),l.a.createElement("br",null),l.a.createElement(oe.a,{variant:"outlined",color:"primary",onClick:function(){return p({variables:{challengeID:n.id,userID:t.id,startDate:a.format("YYYY-MM-DD"),endDate:c.format("YYYY-MM-DD"),description:E}})}},g?"Restart the challenge!":"Start the challenge!")))},be=Object(m.a)((function(e){return{root:{flexGrow:1,marginBottom:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}})),ve=function(e){var n=e.errorMessage;return n?l.a.createElement("div",{style:{color:"red"}},n):null},De=function(){var e=be(),n=Object(r.useState)(null),t=Object(s.a)(n,2),a=t[0],c=t[1],o=F();console.log("user: ",o);var i=ae(),u=Object(D.g)("/challenges/:id"),m=u&&i?i.find((function(e){return e.id===u.params.id})):null;return l.a.createElement("div",{className:e.root},l.a.createElement(w,{user:o}),l.a.createElement(ve,{errorMessage:a}),l.a.createElement(D.c,null,l.a.createElement(D.a,{path:"/login"},l.a.createElement(Q,{setError:c})),l.a.createElement(D.a,{path:"/challenges/:id",exact:!0},m&&l.a.createElement(pe,{challenge:m,user:o})),l.a.createElement(D.a,{path:"/ownChallenges/:id",exact:!0},m&&l.a.createElement(he,{challenge:m})),l.a.createElement(D.a,{path:"/challenges"},o&&l.a.createElement(ce,{username:o.username})),l.a.createElement(D.a,{path:"/"},l.a.createElement(z,null))))},Oe=t(3),je=t(111),we=Object(u.a)((function(e,n){var t=n.headers,r=localStorage.getItem("user-token");return{headers:Object(a.a)({},t,{authorization:r?"bearer ".concat(r):null})}})),Ye=new O.HttpLink({uri:"http://localhost:4000"}),Ce=new je.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0}}),ye=Object(O.split)((function(e){var n=e.query,t=Object(Oe.p)(n);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),Ce,we.concat(Ye)),ke=new O.ApolloClient({cache:new O.InMemoryCache,link:ye});o.a.render(l.a.createElement(i.a,null,l.a.createElement(O.ApolloProvider,{client:ke},l.a.createElement(De,null))),document.getElementById("root"))}},[[119,1,2]]]);
//# sourceMappingURL=main.7ea1fb88.chunk.js.map